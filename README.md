# 🎬 Zoom Publishing Platform

> **Production-Ready Multi-Tenant SaaS для автоматической обработки и публикации видеозаписей**

Полнофункциональная платформа с REST API для автоматизации публикации видеоконтента. Забирает записи из различных источников, обрабатывает их, транскрибирует через AI, извлекает темы, создает структурированное описание с таймкодами и публикует на популярные платформы — полностью автоматически с поддержкой шаблонов и multi-tenancy.

**🆕 v2.0 - Full Production-Ready:**
- ✅ REST API + JWT аутентификация
- ✅ Multi-tenancy с полной изоляцией данных
- ✅ Система шаблонов для автоматизации
- ✅ Роли и права доступа
- ✅ Квоты и rate limiting
- ✅ Background tasks (Celery + Redis)

---

## 🎯 Суть проекта

**Zoom Publishing Platform** — это автоматизированный пайплайн для превращения записей `Zoom`-лекций в готовые к публикации видео с AI-структурированием контента.

### Основная цель

Автоматизация процесса публикации учебных лекций магистратуры «Искусственный Интеллект» (НИУ ВШЭ) с использованием современных AI-технологий для транскрибации и структурирования контента.

### Для кого это

- 🎓 **Учебные программы магистратуры** — оперативная публикация занятий с удобной навигацией по темам
- 📚 **Преподаватели и лекторы** — автоматизация процесса публикации учебного контента
- 🎯 **Студенты магистратуры** — быстрый доступ к структурированным лекциям с таймкодами
- 📢 **Команды контента** — быстрый конвейер «запись → оформленное видео → публикация»

### Главные преимущества

- ⚡ **Быстрее время вывода контента**: `Zoom` → платформа без ручного монтажа
- 📈 **Выше вовлечённость студентов**: компактные видео без «пустых» участков и с кликабельным оглавлением
- 🎨 **Единый стиль публикаций**: описание и таймкоды оформляются по шаблону без ручных ошибок
- 🎓 **Автоматизация учебного процесса**: минимизация ручной работы при публикации лекций

---

## ✨ Что делает система

Система автоматически выполняет полный цикл обработки:

1. **📥 Забирает записи** из `Zoom` (по расписанию или по команде) или принимает локальный файл через `add-video`
2. **✂️ Обрезает тишину** — удаляет пустое начало, конец и длинные паузы
3. **🎤 Транскрибирует аудио** через `Fireworks AI`
4. **🧠 Извлекает темы** через `DeepSeek`:
  - Определяет основные темы (2-3 слова)
  - Создает детализированные темы с таймкодами (3-6 слов, ≤12 минут)
  - Автоматически находит перерывы (паузы ≥8 минут)
5. **📝 Формирует описание**:
  - Раздел «🔹 Темы лекции:» с таймкодами `HH:MM:SS — Название`
  - Автоматическое добавление перерывов
  - Служебная информация: дата публикации, P.S.
6. **🚀 Публикует на платформы** — `YouTube` и `VK` с миниатюрами, плейлистами/альбомами; субтитры загружаются на YouTube
7. **📊 Ведёт журнал операций** и статусов, обрабатывает ошибки, поддерживает повторные попытки

**Итог:** стабильно оформленные, готовые к просмотру видео появляются на платформах без ручного монтажа.

---

## 🔄 Как это работает

1. **🔌 Подключение** `Zoom`-аккаунтов и платформ (`YouTube`/`VK`)
2. **📥 Автосбор** записей за выбранный период
3. **✂️ Техническая чистка** видео (обрезка тишины, экспорт)
4. **🤖 AI-структурирование**: транскрибация, темизация через `DeepSeek`, таймкоды, автоматическое определение перерывов
5. **🚀 Автопубликация** с готовым описанием и миниатюрой

---

## 🚀 Быстрый старт

### Установка

```bash
# Установка UV (рекомендуется)
curl -LsSf https://astral.sh/uv/install.sh | sh

# Установка зависимостей
uv sync
```

> 💡 Альтернативно можно использовать `uv pip install -r requirements.txt`

### Настройка

1. Создайте файлы с учетными данными в папке `config/`:
   - `zoom_creds.json` — `Zoom API`
   - `youtube_creds.json` — `YouTube API`
   - `vk_creds.json` — `VK API`
   - `fireworks_creds.json` — `Fireworks AI` (транскрибация)
   - `deepseek_creds.json` — `DeepSeek` (извлечение тем)

2. Настройте `.env` файл (опционально):
   ```env
   TIMEZONE=Europe/Moscow
   ```

3. Инициализируйте базу данных:
```bash
   uv run python main.py recreate-db
```

### Основные команды

#### Генерация субтитров

Генерация субтитров в форматах SRT и VTT из транскрипций:

```bash
# Генерация субтитров для всех транскрибированных записей
python main.py subtitles --all

# Генерация субтитров только в формате SRT
python main.py subtitles --all --format srt

# Генерация субтитров только в формате VTT
python main.py subtitles --all --format vtt

# Генерация субтитров для записей за последние 7 дней
python main.py subtitles --last 7

# Генерация субтитров для конкретных записей
python main.py subtitles --recordings 1,2,3
```

Субтитры сохраняются в той же директории, что и файлы транскрипций, с расширениями `.srt` и `.vtt`.

### Основные команды

```bash
# Синхронизация записей из Zoom
python main.py sync --last 7

# Полный пайплайн: скачать + обработать + транскрибировать + загрузить
python main.py full-process --all

# Просмотр записей
python main.py list --last 7

# Добавить локальное видео как запись
python main.py add-video "/path/to/video.mp4" --name "Лекция 1" --set-expire 30
```

> 💡 Подробнее о всех командах см. в [Технической документации](docs/TECHNICAL.md)

> 📖 **Подробная документация:** [Руководство по развертыванию](docs/DEPLOYMENT.md) | [Техническая документация](docs/TECHNICAL.md) | [История обновлений](docs/UPDATES.md)

---

## 🛠️ Технологии

- **`Python 3.8+`** с `asyncio` для асинхронной обработки
- **`PostgreSQL`** для хранения метаданных
- **`FFmpeg`** для обработки видео
- **AI сервисы:**
  - 🔥 **`Fireworks AI`** — транскрибация
  - 🧠 **`DeepSeek`** — извлечение тем и структурирование
- **API интеграции:** `Zoom`, `YouTube`, `VK`

> 📖 Полный список технологий и зависимостей см. в [Технической документации](docs/TECHNICAL.md)

---

## 📚 Документация

- 📋 **[История обновлений](docs/UPDATES.md)** — версии и изменения
- 🔧 **[Техническая документация](docs/TECHNICAL.md)** — архитектура, модули, API, команды
- 🚀 **[Руководство по развертыванию](docs/DEPLOYMENT.md)** — установка, настройка, production

---

## 📋 Требования

- 🐍 **`Python 3.8+`** (рекомендуется `3.11+`)
- 🎬 **`FFmpeg`** — обработка видео
- 🗄️ **`PostgreSQL 12+`** — база данных
- 🔑 **API ключи:** `Zoom`, `YouTube`, `VK`, `Fireworks AI`, `DeepSeek`

> 📖 Подробные инструкции по установке и настройке см. в [Руководстве по развертыванию](docs/DEPLOYMENT.md)

---

## 📊 Статусы обработки

| Статус | Описание |
|--------|----------|
| `INITIALIZED` | Инициализировано (загружено из `Zoom API`) |
| `DOWNLOADING` | В процессе загрузки |
| `DOWNLOADED` | Загружено |
| `PROCESSING` | В процессе обработки |
| `PROCESSED` | Обработано (готово к транскрибации) |
| `TRANSCRIBING` | В процессе транскрибации |
| `TRANSCRIBED` | Транскрибировано (готово к загрузке/субтитрам) |
| `UPLOADING` | В процессе загрузки на платформу |
| `UPLOADED` | Загружено на платформу |
| `FAILED` | Ошибка обработки |
| `SKIPPED` | Пропущено |
| `EXPIRED` | Очищено/устарело |

> 📖 Подробнее о статусах и процессе обработки см. [Техническую документацию](docs/TECHNICAL.md)

---

## 🌐 REST API & Multi-Tenancy

### FastAPI REST API

Платформа предоставляет полноценный REST API для программного управления:

```bash
# Запуск API сервера
make api

# Документация API
open http://localhost:8000/docs
```

**Основные endpoints:**
- `/api/v1/auth/*` - Аутентификация (register, login, refresh)
- `/api/v1/recordings/*` - Управление записями
- `/api/v1/templates/*` - Шаблоны обработки
- `/api/v1/sources/*` - Источники данных
- `/api/v1/presets/*` - Пресеты выгрузки
- `/api/v1/configs/*` - Базовые конфигурации
- `/api/v1/credentials/*` - Управление credentials

### Система шаблонов

Автоматизируйте обработку записей с помощью шаблонов:

```json
{
  "name": "Лекции ML",
  "matching_rules": {
    "name_pattern": "Лекция*",
    "source_type": "ZOOM"
  },
  "processing_config": {
    "video": {"remove_silence": true},
    "transcription": {"model": "whisper-v3-turbo"}
  },
  "metadata_config": {
    "title_template": "{original_title} - {date}",
    "description_template": "Темы:\n{topics_list}"
  }
}
```

**Возможности:**
- 📋 Matching rules - автоматическое сопоставление записей
- ⚙️ Processing config - настройки обработки
- 📝 Metadata templates - шаблоны с переменными
- 🎯 Output config - настройки выгрузки
- 🔢 Приоритеты шаблонов

### Multi-Tenancy

Полная изоляция данных для каждого пользователя:
- 🔐 JWT аутентификация
- 👥 Роли (admin/user) и права доступа
- 📁 Изоляция файлов `media/user_{user_id}/`
- 📊 Квоты на ресурсы
- 🔒 Rate limiting

> 📖 Подробный гайд: [FULL_PRODUCTION_GUIDE.md](docs/FULL_PRODUCTION_GUIDE.md)

---

## 🆕 Последние обновления

### v2.0 (2025-01-02) - Full Production-Ready

**Новые возможности:**
- ✅ REST API + JWT аутентификация
- ✅ Multi-tenancy с полной изоляцией
- ✅ Система шаблонов для автоматизации
- ✅ Роли и права доступа
- ✅ Квоты и rate limiting
- ✅ Background tasks (Celery + Redis)
- ✅ 4 новые таблицы БД (templates, sources, presets, configs)
- ✅ Template Matcher для автоматического применения
- ✅ UserPathManager для изоляции файлов

### v0.7.3

- 🔐 Асинхронный `TokenManager` для Zoom c backoff и кешем на аккаунт
- 🎆 Fireworks ASR: валидация конфигов (response_format/diarize/VAD), логирование запросов/ответов, ретраи
- 🧠 Извлечение тем с выбором провайдера (`--topic-model deepseek|fireworks_deepseek`) и режимом детализации (`--topic-mode short|long`)
- 📝 `subtitle_module` и команда `python main.py subtitles`; загрузка субтитров на YouTube при `upload --upload-captions`
- 🗄️ Нормализованные модели БД: `source_metadata`, `output_targets`, расширенные статусы пайплайна

> 📖 Полный список изменений см. в [Истории обновлений](docs/UPDATES.md)

---

## 📄 Лицензия

См. файл [LICENSE](LICENSE)
