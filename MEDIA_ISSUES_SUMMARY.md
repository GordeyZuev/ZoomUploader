# üö® Media System - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (Summary)

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 2026-01-16  
**–ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º:** 10 (3 critical, 4 high, 3 medium)

---

## üî¥ CRITICAL (—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

### 1. Orphaned files –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–µ–π
**–ü—Ä–æ–±–ª–µ–º–∞:** `delete()` —É–¥–∞–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å—å –∏–∑ –ë–î, —Ñ–∞–π–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫–µ  
**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** Storage leak, quota –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–ª–∞—Ç—è—Ç –∑–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–µ  
**–§–∞–π–ª:** `api/repositories/recording_repos.py:564`  
**Fix:** 30 –º–∏–Ω—É—Ç (—Å–º. Quick Win #1 –≤ plan.md)

### 2. –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** Temp files, expired recordings, orphaned files –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è  
**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –î–∏—Å–∫ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è, performance degradation  
**Fix:** 3 —á–∞—Å–∞ (Celery periodic tasks)

### 3. Quota tracking –Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å `get_user_storage_size()` –≤—Ä—É—á–Ω—É—é  
**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –ù–µ—Ç–æ—á–Ω—ã–µ quota, –ø—Ä–æ–±–ª–µ–º—ã —Å billing  
**Fix:** 3 —á–∞—Å–∞ (FileManager —Å auto-tracking)

---

## üü† HIGH (–≤–∞–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)

### 4. –§–∞–π–ª—ã –Ω–∞–∑–≤–∞–Ω—ã –ø–æ display_name
**–ü—Ä–æ–±–ª–µ–º–∞:** `–¢—é–ª—è–≥–∏–Ω_GenDL_25-12-25_12-55_processed.mp4` - –∫–∏—Ä–∏–ª–ª–∏—Ü–∞, –∫–æ–ª–ª–∏–∑–∏–∏, –¥–ª–∏–Ω–Ω—ã–µ –∏–º–µ–Ω–∞  
**–†–µ—à–µ–Ω–∏–µ:** ID-based naming: `142_trimmed.mp4`  
**Fix:** 4 —á–∞—Å–∞

### 5. Thumbnails –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è
**–ü—Ä–æ–±–ª–µ–º–∞:** 22 —Ñ–∞–π–ª–∞ * N users = 5MB * N  
**–†–µ—à–µ–Ω–∏–µ:** Fallback –Ω–∞ templates, –Ω–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å  
**Fix:** 2 —á–∞—Å–∞

### 6. temp_processing –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (–º–æ–∂–µ—Ç –±—ã—Ç—å –≥–∏–≥–∞–±–∞–π—Ç—ã)  
**Fix:** 1 —á–∞—Å (cleanup script + cron)

---

## üü° MEDIUM (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å, –Ω–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å)

### 7. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ audio –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** `audio/processed/` vs `processed_audio/` - inconsistency  
**Fix:** 2 —á–∞—Å–∞ (migration script)

### 8. Legacy –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** `media/video/`, `media/transcriptions/`, `media/data.db` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è  
**Fix:** 1 —á–∞—Å (cleanup)

### 9. Paths –∫–∞–∫ strings –≤ –ë–î
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–æ–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ S3, –Ω–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏  
**–†–µ—à–µ–Ω–∏–µ:** PathBuilder pattern  
**Fix:** 4 —á–∞—Å–∞

---

## üìä –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

```bash
# –†–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:
media/user_4/video/unprocessed/–¢—é–ª—è–≥–∏–Ω GenDL (25.12.2025).mp4
media/user_4/video/processed/–¢—é–ª—è–≥–∏–Ω_GenDL_25-12-25_12-55_processed.mp4
media/user_4/audio/processed/–ü–µ—Ä–µ–≤–æ–¥_–Ω–∞_–ò–ò_25-12-26_07-21_processed.mp3

# –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:
media/user_4/audio/processed/          # ‚Üê –ï—Å—Ç—å —Ñ–∞–π–ª—ã
media/user_4/processed_audio/          # ‚Üê –¢–æ–∂–µ –µ—Å—Ç—å

# Thumbnails:
media/templates/thumbnails/*.png       # 22 —Ñ–∞–π–ª–∞ (~5 MB)
media/user_4/thumbnails/*.png          # 22 —Ñ–∞–π–ª–∞ (~5 MB) - –¥—É–±–ª–∏–∫–∞—Ç—ã!
media/user_5/thumbnails/*.png          # 22 —Ñ–∞–π–ª–∞ (~5 MB) - –¥—É–±–ª–∏–∫–∞—Ç—ã!
media/user_6/thumbnails/*.png          # 22 —Ñ–∞–π–ª–∞ (~5 MB) - –¥—É–±–ª–∏–∫–∞—Ç—ã!
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –î–µ–Ω—å 1: Critical Fixes (4 —á–∞—Å–∞)
1. ‚úÖ Fix delete recording (30 –º–∏–Ω) - **Quick Win #1**
2. ‚úÖ Cleanup temp files script (20 –º–∏–Ω) - **Quick Win #4**
3. ‚úÖ FileManager —Å auto quota tracking (3 —á–∞—Å–∞)

### –î–µ–Ω—å 2: High Priority (7 —á–∞—Å–æ–≤)
4. ‚úÖ ID-based file naming (4 —á–∞—Å–∞)
5. ‚úÖ Thumbnail optimization (2 —á–∞—Å–∞)
6. ‚úÖ Celery cleanup tasks (1 —á–∞—Å)

### –î–µ–Ω—å 3: Medium Priority (7 —á–∞—Å–æ–≤)
7. ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å audio directories (2 —á–∞—Å–∞)
8. ‚úÖ PathBuilder pattern (4 —á–∞—Å–∞)
9. ‚úÖ Cleanup legacy directories (1 —á–∞—Å)

**–ò—Ç–æ–≥–æ:** 3 –¥–Ω—è = –ø–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º

---

## üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π impact

**–¢–µ–∫—É—â–∏–µ –ø–æ—Ç–µ—Ä–∏ (–æ—Ü–µ–Ω–∫–∞ –¥–ª—è 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π):**

1. **Orphaned files:** ~20% storage waste = $200/–º–µ—Å—è—Ü (–ø—Ä–∏ $1000 storage cost)
2. **Duplicate thumbnails:** 5MB * 100 = 500MB waste = $5/–º–µ—Å—è—Ü
3. **Temp files:** ~10% storage = $100/–º–µ—Å—è—Ü

**–ò—Ç–æ–≥–æ:** ~$305/–º–µ—Å—è—Ü –ø–æ—Ç–µ—Ä—å –∏–ª–∏ **$3,660/–≥–æ–¥**

**ROI –æ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** –û–∫—É–ø–∞–µ—Ç—Å—è –∑–∞ 1 –º–µ—Å—è—Ü —Ä–∞–±–æ—Ç—ã

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–î–µ—Ç–∞–ª—å–Ω—ã–π –∞—É–¥–∏—Ç:** `docs/MEDIA_SYSTEM_AUDIT.md`
- **–ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** `plan.md` ‚Üí –§–ê–ó–ê 3: Media System Overhaul
- **Quick Wins:** `plan.md` ‚Üí Quick Wins #1-5

---

**–°—Ç–∞—Ç—É—Å:** Ready to fix  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ù–∞—á–∞—Ç—å —Å Quick Win #1 (delete recording)
